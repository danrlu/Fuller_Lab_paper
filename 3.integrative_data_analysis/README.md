### Input: normalized read counts from RNA-seq and raw counts on CAGE
### Goal: define different gene groups and generate the following files (can be found in /Data folder)

###   ...1) gene lists (ensemble ID.txt, TSS positions.bed) 
###   ...2) CAGE cluster 5' edge, 3' edge, mid point.bed for plotting


#### ============== Step 1. assign CAGE clusters to genes

1.3.1 (preparation) based on fly transcriptome annotation, write out .bed that contains gene exons, no 3'UTR, and from TSS to upstream 500bp. 

1.3.2 (preparation) intersect CAGE clusters to the .bed generated in 1.3.1 to assign the CAGE clusters to gene. Count how many clusters each gene has.

1.3.3 run DESeq2 on CAGE to normalize read counts across samples **should move this to 2.DE folder**


#### =============== Step 2. decide cutoff for different gene groups 

Here only use CAGE clusters that fall within 200bp from annotated TSS. The goal is to use these 'confident' TSS clusters at promoters to determine reasonable cutoff of log2 fold change and expression level for different gene groups. The only output used from this section is log2 fold change and expression level.

2.0 (preparation) write out .bed for 200bp flanking annotated TSS

2.1 decide cutoff of expression level

2.2 decide cutoff of log2 Fold change

2.3 (double check) CAGEr calculates TPM for each cluster, compare that with the counts generated by bedtools. Just to make sure the counting was done properly.


#### ================ Step 3. use the cutoff from Step.2 to define gene groups

3.0 (preparation) consolidate CAGE clusters. CAGEr build clusters for each sample and then make a merged version of consensus clusters. Here intersect all these clusters to create a table how they correspond to each other. 

3.1 merge RNA-seq and CAGE normalized counts and define CAGE cluster type. 

3.2 and 3.3 define gene groups based on RNA-seq profile and which CAGE cluster type (from 3.2) the gene contains. 

3.3 (double check) make sure the gene groups have no overlap.


#### ================ Step 4. create .bed files that align the CAGE clusters to different positions. This is for the next step of plotting

4.3abs create .bed that aligns CAGE clusters by the absolute/total edge of CAGE clusters

4.3intq create .bed that align CAGE clusters by the interquantile edge of CAGE clusters ("the efficient transcription initiation region" used in paper)


#### ================ Step 5. generate scatterplot for paper Figure 1.

5.1 Figure 1C,D 
